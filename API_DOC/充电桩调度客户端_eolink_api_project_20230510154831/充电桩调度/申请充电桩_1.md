# 申请充电桩
## 接口信息

**API Path**
/user/charge/apply

**请求协议**
WS

**相关人员**  
负责人:wyc2002  
创建人:wyc2002  
最后编辑人:wyc2002  
**自定义字段**  
**建立连接时的请求参数（websocket open）**：

**Query参数**：
| 参数名 | 说明 | 必填 | 类型 | 限制 | 示例 |
| :------------ | :------------ | :------------ | :------------ | :------------ | :------------ | :------------ |
|token|用户唯一识别码|是|[string]||djklasjdskljakldjakl|
|mode|用户选择的充电模式|是|[string]||fast/common|
|quantity|用户选择的充电量|是|[float]||100.5|
**建立连接时的响应内容（websocket open）**：
**请求报文**：
**响应报文**：

**返回结果**
>成功 (200)
Json
Object

| 参数名  | 说明 | 必填 | 类型 | 值可能性 | 限制 | 示例 |
| :------------ | :------------ | :------------ | :------------ | :------------ | :------------ | :------------ |
|code|错误码 200为正常，-1为异常|是|[int]| ||200|
|msg|提示信息|是|[string]| ||您已经成功进入队列，请等待|

**详细说明**：
这里使用了websocket协议，当用户发出请求的时候，将建立websocket连接，当用户排队达到的时候，服务器将通过websocket句柄叫号，告诉用户需要进入充电状态，但是此时仍然不需要断开连接，维持当前的状态，此时等待运行结束，进行结算，关闭连接。另外需要说明的是，websocket是在后端开设的一个线程（协程），所以和后端是并行的，并不影响其他的操作，同时在前端需要作为一个全局变量来进行管理，并被所有页面共用，这个点是需要注意的。同时我们可以通过这个socket修改详单的信息，具体向后端发送的指令格式如下：{"operation":"revise", // 进行修改操作，后端利用字典进行查询可以加速，然后利用函数式编程，可以更迅速的使用函数，也就是使用一个表来存储（利用golang和Python均可以实现这个功能）"mode":"quick", // quick为快充}
```
